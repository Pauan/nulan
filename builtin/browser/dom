(IMPORT (file "../list")
| List)

(IMPORT (file "../text")
| Text)

(IMPORT (file "../null")
| Null)

(IMPORT (file "../task")
| Task)

(IMPORT (file "../maybe")
| Maybe)

(IMPORT (file "../changing")
| Changing)

(IMPORT (file "../changing-list")
| Changing-List)

(IMPORT (file "../mutable")
| Mutable
| set!)


(TYPE Root)
(TYPE Event)


(TYPE Style
| (*style Text Text)

| (*changing-style Text (Changing (Maybe Text))))


(TYPE Attribute-Event
| (*attribute-event Text (-> Event (Task Null)))

| (*on-click (-> {} (Task Null)))

| (*on-hover (-> { hovering :: Boolean } (Task Null)))

| (*on-hold (-> { holding :: Boolean } (Task Null))))


(TYPE Attribute
| (*attribute-text Text Text)

| (*attribute-class Text)

| (*attribute-changing-class Text (Changing Boolean))

| (*attribute-events (List Attribute-Event))

| (*attribute-styles (List Style))

| (*attribute-changing-text Text (Changing (Maybe Text))))


(TYPE HTML
| (*parent-list Text (List Attribute) (List HTML))

| (*child Text (List Attribute))

| (*text Text)

| (*changing-text (Changing Text))

| (*changing-parent Text (List Attribute) (Changing-List HTML)))


(UNSAFE-FFI-LOAD { target <= javascript-browser
                 | file <= "../../ffi/browser/dom.js" }
| stylesheet :: (-> Text (List Style) (Task Null))
| stylesheet_class :: (-> Text (List Style) (Task Null))
# TODO make this into a Task ?
| root :: Root
| render :: (-> Root HTML (Task Null)))


(FUNCTION set-hover! :: (-> (Mutable Boolean) Attribute-Event)
| (set-hover! a)
    (on-hover -> { hovering }
      (set! a hovering)))

(FUNCTION set-hold! :: (-> (Mutable Boolean) Attribute-Event)
| (set-hold! a)
    (on-hold -> { holding }
      (set! a holding)))


(EXPORT-CONSTANT
| events <= *attribute-events
| event <= *attribute-event
| on-click <= *on-click
| on-hover <= *on-hover
| on-hold <= *on-hold

| attr <= *attribute-text
| changing-attr <= *attribute-changing-text

| class <= *attribute-class
| changing-class <= *attribute-changing-class

| styles <= *attribute-styles

| style <= *style
| changing-style <= *changing-style

| parent <= *parent-list
| changing-parent <= *changing-parent

| text <= *text
| changing-text <= *changing-text

| child <= *child)

(EXPORT
| Root
| Attribute
| Attribute-Event
| Style
| HTML

| root
| render
| stylesheet
| stylesheet-class <= stylesheet_class
| set-hover!
| set-hold!)
