(IMPORT (file "../list")
| List
| List-Delta)

(IMPORT (file "../text")
| Text)

(IMPORT (file "../null")
| Null)

(IMPORT (file "../task")
| Task)

(IMPORT (file "../maybe")
| Maybe)

(IMPORT (file "../stream")
| Stream)

(IMPORT (file "../mutable")
| Mutable
| set!)


(TYPE Root)
(TYPE Event)


(TYPE Style
| (*style Text Text)

| (*style-stream Text (Stream (Maybe Text))))


(TYPE Attribute-Event
| (*attribute-event Text (-> Event (Task Null)))

| (*on-click (-> {} (Task Null)))

| (*on-hover (-> { hovering :: Boolean } (Task Null)))

| (*on-hold (-> { holding :: Boolean } (Task Null))))


(TYPE Attribute
| (*attribute-text Text Text)

| (*attribute-class Text)

| (*attribute-class-stream Text (Stream Boolean))

| (*attribute-events (List Attribute-Event))

| (*attribute-styles (List Style))

| (*attribute-text-stream Text (Stream (Maybe Text))))


(TYPE HTML
| (*parent-list Text (List Attribute) (List HTML))

| (*child Text (List Attribute))

| (*text Text)

| (*text-stream (Stream Text))

| (*parent-stream Text (List Attribute) (Stream (List-Delta HTML))))


(UNSAFE-FFI-LOAD { target <= javascript-browser
                 | file <= "../../ffi/browser/dom.js" }
| stylesheet :: (-> Text (List Style) (Task Null))
| stylesheet_class :: (-> Text (List Style) (Task Null))
# TODO make this into a Task ?
| root :: Root
| render :: (-> Root HTML (Task Null)))


(FUNCTION set-hover! :: (-> (Mutable Boolean) Attribute-Event)
| (set-hover! a)
    (on-hover -> { hovering }
      (set! a hovering)))

(FUNCTION set-hold! :: (-> (Mutable Boolean) Attribute-Event)
| (set-hold! a)
    (on-hold -> { holding }
      (set! a holding)))


(EXPORT-CONSTANT
| events <= *attribute-events
| event <= *attribute-event
| on-click <= *on-click
| on-hover <= *on-hover
| on-hold <= *on-hold

| attr <= *attribute-text
| attr-stream <= *attribute-text-stream

| class <= *attribute-class
| class-stream <= *attribute-class-stream

| styles <= *attribute-styles

| style <= *style
| style-stream <= *style-stream

| parent <= *parent-list
| parent-stream <= *parent-stream

| text <= *text
| text-stream <= *text-stream

| child <= *child)

(EXPORT
| Root
| Attribute
| Attribute-Event
| Style
| HTML

| root
| render
| stylesheet
| stylesheet-class <= stylesheet_class
| set-hover!
| set-hold!)
